<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>TEMPLATE UNIVERSAL</title>
    <base target="_blank" />
<style type="text/css">
    html, body { margin:0; padding: 1px; background: transparent; margin-bottom: 5px;}
    .adUnit    {  padding: 11px 2px 2px 2px; border: 1px solid red; margin-bottom: 0px; background: transparent url('http://www.zoomnews.es/themes/zen/newstheme/images/publicidad/tagpublihoredecea.png') no-repeat 4px 2px; position: relative;}
    .template  { display: none; }
    img#publitag{
	     	display: block;
	        margin: 0px ;
	        padding: 0px 0px 2px 0px;
	        
        }
    .adSpace{
	    
    }
    
    a img{
	    border:none;
	    padding: 0;
	    margin: 0;
    }
    .transpGif{
	    position: relative; z-index: 1000;
    }
    .flashAd{position: absolute; z-index: 10;top:10px; left:2px;}
</style>
</head>
<body xmlns:tmp="javascript:" id="adBody">




    <!-- Include the cx.js script -->
    <script type="text/javascript">
        (function() { try { var scriptEl = document.createElement('script'); scriptEl.type = 'text/javascript'; scriptEl.async = 'async';
        scriptEl.src = ('https:' == document.location.protocol) ? 'https://scdn.cxense.com/cx.js' : 'http://cdn.cxense.com/cx.js';
        var targetEl = document.getElementsByTagName('script')[0]; targetEl.parentNode.insertBefore(scriptEl, targetEl); } catch (e) {}; }());
        
    </script>
    
    <!-- if it's a third party ad tag, the ad will show in this IFRAME (initally hidden): -->
    <iframe id="thirdPartyAdIFrame" width="0" height="0" marginwidth="0" style="display:none; background: transparent url('http://www.zoomnews.es/themes/zen/newstheme/images/publicidad/tagpublihoredecea.png') no-repeat 4px 2px;padding: 14px 0px 0px 4px;border: 1px solid #edecea; margin: 0px;font-size:0;" marginheight="0" hspace="0" vspace="0" frameborder="0" scrolling="no" ></iframe>
    
    <!-- The ads are inserted into this div: -->
   
    <div id="adSpace" class="adSpace"></div>
    
    <!-- or if it's a third party ad tag, the ad will show in this IFRAME (initally hidden): -->

   
   
        <!-- This is the invisible template that is used to instanciate the ad -->
        <div id="adsTemplate" class="template">

        <!--%
        
        hook();
        
	function getURLParameters(paramName) 
	{
		var sURL = window.document.URL.toString();  
		if (sURL.indexOf("#") > 0)
		{
			var arrParams = sURL.split("#");         
			var arrURLParams = arrParams[1].split("&");      
			var arrParamNames = new Array(arrURLParams.length);
			var arrParamValues = new Array(arrURLParams.length);     
			var i = 0;
			for (i=0;i<arrURLParams.length;i++)
			{
				var sParam =  arrURLParams[i].split("=");
				arrParamNames[i] = sParam[0];
				if (sParam[1] != "")
					arrParamValues[i] = unescape(sParam[1]);
				else
				arrParamValues[i] = "No Value";
			}	
		
			for (i=0;i<arrURLParams.length;i++)
			{
				if(arrParamNames[i] == paramName){
					////alert("Param:"+arrParamValues[i]);
					return arrParamValues[i];
				}
			}
			return 0;
		}
	}


        
        //INICIALIZACION
		altoAdSpace = 0;
		anchoAdSpace = 0;
		altoBanner = 0;
		anchoBanner = 0;
		var banner = "";
		var bannerAlt = "";
		var title = "";
		var clickUrl = ""
		var thirdParty = "";
		var adCount = 0;
		var codigoFinal = "";

        
        if (data) {
            var dump = JSON.stringify(data);
			//alert (dump);
        }else{
        	//alert('no data');
        }
        
        if (data.searchResult.spaces[0].ads[0].creative.thirdPartyAdCode){
      	  //alert ("THIRDPARTY");
        
        	var ad = data.searchResult.spaces[0].ads[0].creative;
			altoBanner = data.searchResult.spaces[0].ads[0].creative.extractedThirdPartyData[0].thirdPartyImage.imgHeight;
			if(data.searchResult.spaces[0].adUnitHeight > altoBanner){
				altoBanner = data.searchResult.spaces[0].adUnitHeight;
			}
			anchoBanner = data.searchResult.spaces[0].ads[0].creative.extractedThirdPartyData[0].thirdPartyImage.imgWidth;
			if(data.searchResult.spaces[0].adUnitWidth > anchoBanner){
				anchoBanner = data.searchResult.spaces[0].adUnitWidth;
			}
			altoAdSpace = parseInt(altoBanner)  + 22;
			anchoAdSpace = parseInt(anchoBanner) + 12;
			altoIframe = parseInt(altoBanner) + 2;
			anchoIframe = parseInt(anchoBanner) + 2;
			var dump = JSON.stringify(data);
	
			%-->
			
			
		
			<!--%
		
		
			// Since the third-party ad tags might use document.write, and this document is already closed, we must open a new document stream in an IFRAME:
			
			var thirdPartyAdIFrameEl = document.getElementById('thirdPartyAdIFrame');
			
			thirdPartyAdIFrameEl.style.width=anchoIframe+"px";
			thirdPartyAdIFrameEl.style.height=altoIframe+"px";
			
			
			var contentDoc = thirdPartyAdIFrameEl.contentDocument || thirdPartyAdIFrameEl.contentWindow.document;
			
			contentDoc.open();
			
			// Write a proper DOCTYPE, so that we avoid Quirksmode in IE:
			
			contentDoc.write('<!DOCTYPE HTML>\n');
			
			contentDoc.write('<html>\n');
			
			contentDoc.write('<head>\n<title></title>\n<base target="_blank" />');
			
			contentDoc.write('<style type="text/css">html, body, div { margin:0; padding: 0; }</style>\n');
			
			contentDoc.write('</head>\n<body style="overflow:hidden;width:' + anchoAdSpace + 'px !important;height:' + altoAdSpace + 'px !important;">\n');
			
					
			contentDoc.write('' + ad.thirdPartyAdCode + '\n</body>\n</html>\n');
			
			thirdPartyAdIFrameEl.style.display = 'block';
        
        }else if (data && data.searchResult && data.searchResult.spaces && data.searchResult.spaces[0] && data.searchResult.spaces[0].ads && thirdParty==='') {
			  //alert ("CXENSE");
			var ads = data.searchResult.spaces[0].ads;
				
			for (var i = 0; i < ads.length; i++) {
				var ad = ads[i];
				banner=''; 
				video='';
				clickUrl = ad.clickUrl;
				title = ad.title;
				
				if (/combocreative/.test(ad.creative.type.toLowerCase())){
					  //alert ("COMBO");
					  
					  
					if (ad.creative.flashFiles && ad.creative.flashFiles.length) {
					//SI ES FLASH
					//alert ("flash");
					
						var flashfile;
						for (var j = 0; j < ad.creative.flashFiles.length; j++) {
							flashfile = ad.creative.flashFiles[j];
							if (flashfile.height > altoBanner || flashfile.width > anchoBanner){ //MOSTRAMOS SIEMPRE EL BANNER MAS GRANDE DISPONIBLE
								altoBanner = flashfile.height;
								anchoBanner = flashfile.width;
								banner = flashfile.source;
								
								
							}
						}
						altoAdSpace = parseInt(altoBanner) + 20;
						anchoAdSpace = parseInt(anchoBanner) + 10;
						altoAdSpace = parseInt(altoBanner) + 20;
						anchoAdSpace = parseInt(anchoBanner) + 10;
						
						var imagen;
						for (var j = 0; j < ad.creative.images.length; j++) {
							image = ad.creative.images[j];
							if (image.height == altoBanner && image.width == anchoBanner){ //ELEGIMOS LA IMAGEN QUE CORRESPONDA AL TAMAÃ‘O DEL BANNER FLASH
								bannerAlt = image.source;
								
								
							}
						}
						
						
						
						
						codigoFinal = '<div class="adUnit FlashComboCreative"><a href="'+clickUrl+'" target="_blank"><img class="adImage" src="'+banner+'"alt="'+alt+'"/></a></div>';
						codigoFinal += '<img class="adImage transpGif" width="'+anchoBanner+'px" height="'+altoBanner+'px" src="http://www.zoomnews.es/themes/zen/newstheme/resources/publi/transp.gif" alt="'+alt+'"/></a>';
						codigoFinal += '<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="'+anchoBanner+'" height="'+altoBanner+'" id="movie_name" align="middle" class="flashAd" data="'+banner+'">';
						codigoFinal += '<param name="movie" value="'+banner+'"/>';
						codigoFinal += '<param name="wmode" value="opaque"/>';
						codigoFinal += '<!--[if !IE]>';
						codigoFinal += '<object type="application/x-shockwave-flash" data="'+banner+'" width="'+anchoBanner+'" height="'+altoBanner+'">';
						codigoFinal += '<param name="movie" value="'+banner+'"/>';
						codigoFinal += '<param name="wmode" value="opaque"/>';
						codigoFinal += '<!--<![endif]>';
						codigoFinal += '<a href="'+clickUrl+'">';
						codigoFinal += '<img src="'+bannerAlt+'" alt="'+title+'"/>';
						codigoFinal += '</a>';
						codigoFinal += '<!--[if !IE]>';
						codigoFinal += '</object>';
						codigoFinal += '<!--<![endif]>';
						codigoFinal += '</object>';
						codigoFinal += '</div>';

					
					var thirdPartyAdIFrameEl = document.getElementById('thirdPartyAdIFrame');
					altoIframe = parseInt(altoBanner) + 2;
					anchoIframe = parseInt(anchoBanner) + 2;
					thirdPartyAdIFrameEl.style.width=anchoIframe+"px";
					thirdPartyAdIFrameEl.style.height=altoIframe+"px";
					var contentDoc = thirdPartyAdIFrameEl.contentDocument || thirdPartyAdIFrameEl.contentWindow.document;
					
					contentDoc.open();
					
					// Write a proper DOCTYPE, so that we avoid Quirksmode in IE:
					
					contentDoc.write('<!DOCTYPE HTML>\n');
					
					contentDoc.write('<html>\n');
					
					contentDoc.write('<head>\n<title></title>\n<base target="_blank" />');
					
					contentDoc.write('<style type="text/css">html, body, div { margin:0; padding: 0; }</style>\n');
					
					contentDoc.write('</head>\n<body style="overflow:hidden;width:' + anchoAdSpace + 'px !important;height:' + altoAdSpace + 'px !important;">\n');
					
							
					contentDoc.write('' + codigoFinal + '\n</body>\n</html>\n');
					
					thirdPartyAdIFrameEl.style.display = 'block';
						
						%-->
					
				
				
		
					<!--%

					
					
					 
					
	
					}else if (ad.creative.images && ad.creative.images.length) {
					//NOFLASH				
					//alert ("noflash");
					
					
						var imagen;
						for (var j = 0; j < ad.creative.images.length; j++) {
							image = ad.creative.images[j];
							if (image.height > altoBanner || image.width > anchoBanner){ //MOSTRAMOS SIEMPRE EL BANNER MAS GRANDE DISPONIBLE
								altoBanner = image.height;
								anchoBanner = image.width;
								banner = image.source;
								
								
							}
						}
						altoAdSpace = parseInt(altoBanner) + 20;
						anchoAdSpace = parseInt(anchoBanner) + 10;
						altoAdSpace = parseInt(altoBanner) + 20;
						anchoAdSpace = parseInt(anchoBanner) + 10;
						
						
						
						codigoFinal = '<div class="adUnit imgComboCreative">';
						codigoFinal += '<a href="'+clickUrl+'" target="_blank"><img class="adImage" src="'+banner+'"alt="'+title+'"/></a>';
						codigoFinal += '</div>';

						//alert(codigoFinal);

					
					var thirdPartyAdIFrameEl = document.getElementById('thirdPartyAdIFrame');
					altoIframe = parseInt(altoBanner) + 2;
					anchoIframe = parseInt(anchoBanner) + 2;
					thirdPartyAdIFrameEl.style.width=anchoIframe+"px";
					thirdPartyAdIFrameEl.style.height=altoIframe+"px";
					var contentDoc = thirdPartyAdIFrameEl.contentDocument || thirdPartyAdIFrameEl.contentWindow.document;
					
					contentDoc.open();
					
					// Write a proper DOCTYPE, so that we avoid Quirksmode in IE:
					
					contentDoc.write('<!DOCTYPE HTML>\n');
					
					contentDoc.write('<html>\n');
					
					contentDoc.write('<head>\n<title></title>\n<base target="_blank" />');
					
					contentDoc.write('<style type="text/css">html, body, div { margin:0; padding: 0; }</style>\n');
					
					contentDoc.write('</head>\n<body style="overflow:hidden;width:' + anchoAdSpace + 'px !important;height:' + altoAdSpace + 'px !important;">\n');
					
							
					contentDoc.write('' + codigoFinal + '\n</body>\n</html>\n');
					
					thirdPartyAdIFrameEl.style.display = 'block';
					
					%-->
						
							
						
			
					<!--%
					
					
					}
					
		
				//FIN IF COMBO CREATIVE
				}else{
				  //alert ("NORMAL");
				
					banner = ad.creative.source;
					clickUrl = ad.clickUrl; 
					alt = ad.creative.description;                       
					altoBanner = ad.creative.spec.height; 
					anchoBanner = ad.creative.spec.width;
					
					
					if (ad.creative.images && ad.creative.images.length) {
			
						// Iterate over all images and select the one we want to show.
						// Here too the field name is custom, so you need to match this field name against what you set in the combo creative.
			
						var images = ad.creative.images;
						//var imageSrc = '';
			
			
						for (var k = 0; k < images.length; k++) {
							var image = images[k];
							var alt="test";
			
							if (/300x250/.test(image.key.toLowerCase()) && banner==='') { 
								banner = image.source;  testpubli.html
								altoBanner=250;
			
							}else if (/300x600/.test(image.key.toLowerCase())) { 
								banner = image.source;                          
								altoBanner=600; 
								
							}else{
								banner = image.source;                          
								altoBanner=200; 
							}
						} //FIN FOR
						
		
						clickUrl = ad.clickUrl;
						
			
						
					} //FIN IF
					
					var isFlash = (banner.indexOf('.swf') > -1); //true
					
					if(isFlash){
						  //alert ("FLASH");
						altoAdSpace = parseInt(altoBanner) + 20;
						anchoAdSpace = parseInt(anchoBanner) + 10;
						
						
						//codigoFinal = '<div class="adUnit noComboFlash" ><a href="'+clickUrl+'" target="_blank"><img class="adImage" src="'+banner+'"alt="'+alt+'"/></a></div>';
						codigoFinal = '<div class="adUnit noComboFlash" ><a href="'+clickUrl+'" target="_blank">';
						codigoFinal += '<img class="adImage transpGif" width="'+anchoBanner+'px" height="'+altoBanner+'px" src="http://www.zoomnews.es/themes/zen/newstheme/resources/publi/transp.gif" alt="'+alt+'"/></a>';
						codigoFinal += '<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="'+anchoBanner+'" height="'+altoBanner+'" id="movie_name" align="middle" class="flashAd" data="'+banner+'">';
						codigoFinal += '<param name="movie" value="'+banner+'"/>';
						codigoFinal += '<param name="wmode" value="opaque"/>';
						codigoFinal += '<!--[if !IE]>';
						codigoFinal += '<object type="application/x-shockwave-flash" data="'+banner+'" width="'+anchoBanner+'" height="'+altoBanner+'">';
						codigoFinal += '<param name="movie" value="'+banner+'"/>';
						codigoFinal += '<param name="wmode" value="opaque"/>';
						codigoFinal += '<!--<![endif]>';
						codigoFinal += '<a href="http://www.adobe.com/go/getflash">';
						codigoFinal += '<img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player"/>';
						codigoFinal += '</a>';
						codigoFinal += '<!--[if !IE]>';
						codigoFinal += '</object>';
						codigoFinal += '<!--<![endif]>';
						codigoFinal += '</object>';
						codigoFinal += '</div>';

					
					var thirdPartyAdIFrameEl = document.getElementById('thirdPartyAdIFrame');
					altoIframe = parseInt(altoBanner) + 2;
					anchoIframe = parseInt(anchoBanner) + 2;
					thirdPartyAdIFrameEl.style.width=anchoIframe+"px";
					thirdPartyAdIFrameEl.style.height=altoIframe+"px";
					var contentDoc = thirdPartyAdIFrameEl.contentDocument || thirdPartyAdIFrameEl.contentWindow.document;
					
					contentDoc.open();
					
					// Write a proper DOCTYPE, so that we avoid Quirksmode in IE:
					
					contentDoc.write('<!DOCTYPE HTML>\n');
					
					contentDoc.write('<html>\n');
					
					contentDoc.write('<head>\n<title></title>\n<base target="_blank" />');
					
					contentDoc.write('<style type="text/css">html, body, div { margin:0; padding: 0; }</style>\n');
					
					contentDoc.write('</head>\n<body style="overflow:hidden;width:' + anchoAdSpace + 'px !important;height:' + altoAdSpace + 'px !important;">\n');
					
							
					contentDoc.write('' + codigoFinal + '\n</body>\n</html>\n');
					
					thirdPartyAdIFrameEl.style.display = 'block';
						
					%-->
		
					<!--%
					altoAdSpace = parseInt(altoBanner) + 20;
					anchoAdSpace = parseInt(anchoBanner) + 10;
						
					
					
					
					}else{
						  //alert ("IMG");
					
						altoAdSpace = parseInt(altoBanner) + 20;
					anchoAdSpace = parseInt(anchoBanner) + 10;
					
					codigoFinal = '<div class="adUnit noComboImg"><a href="'+clickUrl+'" target="_blank"><img class="adImage" src="'+banner+'"alt="'+alt+'"/></a></div>';
					
					
					
					var thirdPartyAdIFrameEl = document.getElementById('thirdPartyAdIFrame');
					altoIframe = parseInt(altoBanner) + 2;
					anchoIframe = parseInt(anchoBanner) + 2;
					thirdPartyAdIFrameEl.style.width=anchoIframe+"px";
					thirdPartyAdIFrameEl.style.height=altoIframe+"px";
					var contentDoc = thirdPartyAdIFrameEl.contentDocument || thirdPartyAdIFrameEl.contentWindow.document;
					
					contentDoc.open();
					
					// Write a proper DOCTYPE, so that we avoid Quirksmode in IE:
					
					contentDoc.write('<!DOCTYPE HTML>\n');
					
					contentDoc.write('<html>\n');
					
					contentDoc.write('<head>\n<title></title>\n<base target="_blank" />');
					
					contentDoc.write('<style type="text/css">html, body, div { margin:0; padding: 0; }</style>\n');
					
					contentDoc.write('</head>\n<body style="overflow:hidden;width:' + anchoAdSpace + 'px !important;height:' + altoAdSpace + 'px !important;">\n');
					
							
					contentDoc.write('' + codigoFinal + '\n</body>\n</html>\n');
					
					thirdPartyAdIFrameEl.style.display = 'block';
					
					altoAdSpace = parseInt(altoBanner) + 20;
					anchoAdSpace = parseInt(anchoBanner) + 10;
					}
				} //FIN ELSE NO COMBO CREATIVE
				
				
				
			} //FIN FOR
			altoAdSpace = parseInt(altoBanner) + 20;
			anchoAdSpace = parseInt(anchoBanner) + 10;
			%-->
			
			
			
			<!--% 
		} //FIN ELSE IF
        altoAdSpace = parseInt(altoBanner) + 20;
		anchoAdSpace = parseInt(anchoBanner) + 10;
        %-->

            
    </div>
    	

    </div>
    
    
    
     <script type="text/javascript">
        function sendParentResizeMessage(event, data, context) {
            if (context && context.parentElementId) {
                if (parent && parent.postMessage) {
                    var message = 'method=updateAdSpace'
                    	+ '&contentHeight=' + altoAdSpace
                    	+ '&contentWidth=' + anchoAdSpace
                    	+ '&isVerticallyOriented=true'
                        + '&matchedAdCount=' + data.searchResult.spaces[0].ads.length
                        + '&elementId=' + encodeURIComponent(context.parentElementId);
  
                    // It's safe to use '*' as targetOrigin here, because the message content is not secret.
                    window.parent.postMessage(message, '*');
                }
            }
        }
    </script>
  
    
    <!-- Insert AdSpace -->
    <script type="text/javascript">

        function hook() {
            return;
        }
        var cX = cX || {}; cX.callQueue = cX.callQueue || [];
        cX.callQueue.push(['insertAdSpace', {
            templateElementId: 'adsTemplate',
            targetElementId: 'adSpace',
            forwardHashArgs: true,
            onImpressionResult: sendParentResizeMessage
     
        } ]);
    </script>
</body>
</html>

